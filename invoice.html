<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Invoice</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="styling/style.css" />
  </head>
  <body>
    <div id="invoiceModal"></div>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha384-tsQFqpEReu7ZLhBV2VZlAu7zcOV+rXbYlF2cqB8txI/8aZajjp4Bqd+V6D5IgvKT" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>
    <script src="invoice.js"></script>
  </body>
  <script>
  $(document).ready(function(){
    let id = sessionStorage.getItem("sent");

    $.ajax({
      url: `http://api.test.hotelmolveno.carpago.nl/api/reservationjoinguestonid/${id}`,
      type: "get",
      dataType: "json",
      success: function(reservationData) {
        let arrival = new Date(reservationData[0].arrivalDate);
        let departure = new Date(reservationData[0].departureDate);
        let total = totalDays(reservationData[0].arrivalDate, reservationData[0].departureDate);
        let totalPrice = reservationData[0].roomPrice * total;
        $("#invoiceModal").html(`<div class="modal-content"><div class="modal-header">
          <h2>Invoice of ${reservationData[0].firstName} ${reservationData[0].lastName}.</h2></div>
          <div class="modal-body"><div class="row"><div class="col"><b>Stayed in room:</b> ${reservationData[0].roomNumber} (${reservationData[0].roomType})</div></div>
          <div class="row"><div class="col"><b>Arrival date:</b> ${arrival.getDate()}-${arrival.getMonth()+1}-${arrival.getFullYear()}</div>
          <div class="col"><b>Departure date:</b> ${departure.getDate()}-${departure.getMonth()+1}-${departure.getFullYear()}</div></div><br />
          <div class="row"><div class="col"><b>Total days:</b> ${total} (€ ${reservationData[0].roomPrice},- per day)</div><div class="col">€ ${totalPrice},-</div></div><br />
          <div id='accessories'><b>Accessories</b></div><br /><div class="row" id="totalPrice"></div></div></div>`);
          $.ajax({
            url: `http://api.test.hotelmolveno.carpago.nl/api/reservationjoinguestonid/${id}`,
            type: "get",
            dataType: "json",
            success: function(accessoryData) {
              let totalAcc = 0;
              for (let i = 0; accessoryData.length > i; i++) {
                $("#accessories").append(`<div class="row"><div class="col">${accessoryData[i].name} (€ ${accessoryData[i].price} per day)</div><div class="col">€ ${accessoryData[i].price * total},-</div></div>`);
                totalAcc += (accessoryData[i].price * total);
              }
              $("#accessories").append(`<div class="row"><div class="col"><b>Total Price Accessories:</b></div><div class="col">€ ${totalAcc},-</div></div>`);
              $("#totalPrice").html(`<div class="col"><b>Total:</b></div><div class="col"><b><u>€ ${totalPrice + totalAcc},-</u></b></div>`);
              return;
            },
            error: function(error) {
              console.log(error);
            }
          });
        return;
      },
      error: function(error) {
        console.log(error);
      }
    });
  });

  function totalDays(ar, dep) {
    let arrival = new Date(ar);
    let departure = new Date(dep);
    return ((((departure.getTime() - arrival.getTime()) / 1000) / 60) / 60) / 24;
  }
  </script>
</html>
